<% if current_user.role == 'student_worker' || 'program_director' || 'super_user' %>
  <div class="mx-auto md:w-2/3 w-full flex">
    <%= render 'layouts/navbar' %>
    <div class="mx-auto">
      <% if notice.present? %>
        <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
      <% end %>

      <%= render @student %>

      <div class="mt-5">
        <h2 class="text-xl font-medium mb-3">Custom Attributes</h2>
        <% @custom_attributes = CustomAttribute.where(active: true) %>
        <% @custom_attributes.each do |attribute| %>
          <div class="mb-3">
            <span class="custom-attribute" data-attribute-id="<%= attribute.id %>">
              <%= attribute.name %>: <%= @student.custom_attribute_value(attribute.name) %>
            </span>
            <%= form_with url: update_custom_attribute_student_path(@student), method: :post, local: true, class: "inline hidden" do |f| %>
              <%= hidden_field_tag :attribute_id, attribute.id %>
              <%= text_field_tag :value, @student.custom_attribute_value(attribute.name), class: "ml-2" %>
              <%= f.submit 'Update', class: "ml-2 py-1 px-3 bg-blue-500 text-white rounded-lg" %>
            <% end %>
          </div>
        <% end %>
      </div>

      <%= link_to "Edit this student", edit_student_path(@student), data: { turbo: false }, class: "mt-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium" %>
      <%= link_to "Back to students", students_path, data: { turbo: false }, class: "ml-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium" %>
      <div class="inline-block ml-2">
        <%= button_to "Delete this student", @student, data: { turbo: false }, method: :delete, class: "mt-2 rounded-lg py-3 px-5 bg-gray-100 font-medium" %>
      </div>
      <div id="student-id" style="display:none"> 
            <%= @student.id %>
      </div>
      <a id="notes-show"><div id="notes_button" class= "mt-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium" >Notes</div></a>
    </div>
  </div>

  <script>
    /* START NOTES HYPERLINK */
    var notes_show_hyperlink = "/notes/";
    var student_id = document.getElementById("student-id").innerHTML.trim();
    notes_show_hyperlink = notes_show_hyperlink + student_id;
    var notes_show_button = document.getElementById("notes-show");
    notes_show_button.setAttribute('href', notes_show_hyperlink);
    /* END NOTES HYPERLINK */
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.custom-attribute').forEach(function(element) {
        element.addEventListener('click', function() {
          var attributeId = this.getAttribute('data-attribute-id');
          var form = this.nextElementSibling;

          if (form && form.tagName === 'FORM') {
            form.classList.toggle('hidden');
          }
        });
      });
    });
  </script>
<% end %>
