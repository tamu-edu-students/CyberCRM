<!-- app/views/notes/index.html.erb -->
<div class="mx-auto md:w-2/3 w-full flex">
  <div class="mx-auto">
    <%= render 'layouts/navbar' %>
    <% if notice.present? %>
      <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
    <% end %>

    <h1>Notes</h1>

    <%= form_with(url: notes_path, method: :get, local: true) do |f| %>
      <div class="flex flex-wrap mb-4">
        <div class="w-full md:w-1/3 px-2">
          <%= f.label :note_created_date, "Date Entered" %>
          <%= f.date_field :note_created_date, class: "form-input mt-1 block w-full" %>
        </div>
        <div class="w-full md:w-1/3 px-2">
          <%= f.label :note, "Note" %>
          <%= f.text_field :note, class: "form-input mt-1 block w-full" %>
        </div>
        <div class="w-full md:w-1/3 px-2">
          <%= f.label :followup_date, "Follow Up Date" %>
          <%= f.date_field :followup_date, class: "form-input mt-1 block w-full" %>
        </div>
        <div class="w-full md:w-1/3 px-2">
          <%= f.label :followup_action, "Follow Up Action" %>
          <%= f.text_field :followup_action, class: "form-input mt-1 block w-full" %>
        </div>
        <div class="w-full md:w-1/3 px-2">
          <%= f.label :action_completed, "Done?" %>
          <%= f.select :action_completed, options_for_select([['Yes', true], ['No', false]]), include_blank: true, class: "form-select mt-1 block w-full" %>
        </div>
      </div>
      <div class="flex justify-end">
        <%= f.submit "Filter", class: "rounded-lg py-3 px-5 bg-gray-100 font-medium hover:bg-gray-200" %>
      </div>
    <% end %>

    <div id="notes" class="mt-4 overflow-x-auto">
      <table class="min-w-full border-collapse border border-gray-300">
        <thead>
          <tr>
            <th class="border border-gray-300 px-4 py-2">
              <%= sortable "note_created_date", "Date Entered" %>
            </th>
            <th class="border border-gray-300 px-4 py-2">
              <%= sortable "note", "Note" %>
            </th>
            <th class="border border-gray-300 px-4 py-2">
              <%= sortable "followup_date", "Follow Up Date" %>
            </th>
            <th class="border border-gray-300 px-4 py-2">
              <%= sortable "followup_action", "Follow Up Action" %>
            </th>
            <th class="border border-gray-300 px-4 py-2" style="width: 2vw;">
              <%= sortable "action_completed", "Done?" %>
            </th>
          </tr>
        </thead>
        <tbody>
          <% @notes.each do |note| %>
            <tr>
              <td class="border border-gray-300 px-4 py-2"><%= note.note_created_date %></td>
              <td class="border border-gray-300 px-4 py-2"><%= note.note %></td>
              <td class="border border-gray-300 px-4 py-2"><%= note.followup_date %></td>
              <td class="border border-gray-300 px-4 py-2"><%= note.followup_action %></td>
              <td class="border border-gray-300 px-4 py-2"><%= note.action_completed %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const rows = document.querySelectorAll("tr[data-href]");
    rows.forEach(row => {
      row.addEventListener("click", function() {
        window.location.href = this.dataset.href;
      });
    });
  });
</script>
